# Maintainer: Deadbush225 <your-email@example.com>
pkgname=folder-customizer
pkgver=0.0.15
pkgrel=1
pkgdesc="Customize folder icons and add tags to organize your directories"
arch=('x86_64')
url="https://github.com/Deadbush225/folder-customizer"
license=('MIT')
depends=('qt6-base')
source=()
md5sums=()

package() {
    # Install binary and libraries
    install -dm755 "$pkgdir/usr/lib/$pkgname"
    
    # Copy from the bin/ subdirectory
    if [ -f "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/bin/FolderCustomizer" ]; then
        cp "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/bin/FolderCustomizer" "$pkgdir/usr/lib/$pkgname/FolderCustomizer"
    fi
    
    # Copy libraries if they exist
    if [ -d "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/lib" ] && ls "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/lib"/*.so* 1> /dev/null 2>&1; then
        cp "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/lib"/*.so* "$pkgdir/usr/lib/$pkgname/" 2>/dev/null || true
    fi
    
    # Copy other files as needed
    if [ -f "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/manifest.json" ]; then
        cp "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/dist/linux/manifest.json" "$pkgdir/usr/lib/$pkgname/"
    fi
    
    # Copy post-install.sh for post_install() function to use
    if [ -f "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/scripts/post-install.sh" ]; then
        cp "/media/deadbush225/LocalDisk/System/Coding/Projects/folder-customizer/scripts/post-install.sh" "$pkgdir/usr/lib/$pkgname/post-install.sh"
        chmod +x "$pkgdir/usr/lib/$pkgname/post-install.sh"
    fi
    
    # Create wrapper script
    install -dm755 "$pkgdir/usr/bin"
    cat > "$pkgdir/usr/bin/$pkgname" << 'EOFSCRIPT'
#!/bin/bash
export LD_LIBRARY_PATH="/usr/lib/folder-customizer:$LD_LIBRARY_PATH"
export PATH="/usr/lib/folder-customizer:$PATH"
exec "/usr/lib/folder-customizer/FolderCustomizer" "$@"
EOFSCRIPT
    chmod +x "$pkgdir/usr/bin/$pkgname"
    
    # Desktop file
    install -dm755 "$pkgdir/usr/share/applications"
    cat > "$pkgdir/usr/share/applications/$pkgname.desktop" << 'EOFDESKTOP'
[Desktop Entry]
Name=Folder Customizer
Comment=Customize folder icons and add tags to organize your directories
Exec=folder-customizer
Icon=folder-customizer
Type=Application
Categories=Utility;FileManager;Qt;
EOFDESKTOP

    # Application icon
    install -dm755 "$pkgdir/usr/share/icons/hicolor/256x256/apps"
}

post_install() {
    # Run post-install.sh if it exists
    if [ -f "/usr/lib/folder-customizer/post-install.sh" ]; then
        echo "Running post-installation customization..."
        bash "/usr/lib/folder-customizer/post-install.sh" "/usr" "folder-customizer" "Folder Customizer" || true
    fi
    
    # Update desktop database
    if command -v update-desktop-database >/dev/null 2>&1; then
        update-desktop-database /usr/share/applications 2>/dev/null || true
    fi
    
    # Update icon cache
    if command -v gtk-update-icon-cache >/dev/null 2>&1; then
        gtk-update-icon-cache -t /usr/share/icons/hicolor 2>/dev/null || true
    fi
}
