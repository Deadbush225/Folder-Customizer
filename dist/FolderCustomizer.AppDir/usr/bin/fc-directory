#!/bin/bash
set -e
usage() { echo "Usage: fc-directory --folder PATH --tone (Dark|Light|Normal) --color COLOR [--tag TEXT]" >&2; }
for arg in "$@"; do
    case "$arg" in
        --folder=*) FOLDER="${arg#*=}" ;;
        --tone=*) TONE="${arg#*=}" ;;
        --color=*) COLOR="${arg#*=}" ;;
        --tag=*) TAG="${arg#*=}" ;;
    esac
done
[ -z "$FOLDER" ] && usage && exit 2
[ -z "$TONE" ] && usage && exit 2
[ -z "$COLOR" ] && usage && exit 2
    ICON_BASE_APP="$(dirname "$(readlink -f "$0")")/../share/folder-customizer/icons"
    if [ ! -f "$ICON_BASE_APP/$TONE/$COLOR.png" ]; then
        echo "Icon not found in AppImage: $TONE/$COLOR.png" >&2; exit 3
    fi
    # Persist a copy under user-local share so the .directory works after app exits
    DEST_BASE="$HOME/.local/share/folder-customizer/icons/$TONE"
    mkdir -p "$DEST_BASE"
    cp -f "$ICON_BASE_APP/$TONE/$COLOR.png" "$DEST_BASE/"
    ICON_PATH="$DEST_BASE/$COLOR.png"
mkdir -p "$FOLDER"
cat > "$FOLDER/.directory" <<EOD
[Desktop Entry]
Icon=$ICON_PATH
EOD
[ -n "$TAG" ] && echo "Comment=$TAG" >> "$FOLDER/.directory"
echo "Applied icon to $FOLDER"
